{"version":3,"file":"controls.js","sourceRoot":"","sources":["../../src/features/controls.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {PerspectiveCamera, Spherical, Vector3} from 'three';\n\nimport {$ariaLabel, $needsRender, $onModelLoad, $onResize, $scene, $tick} from '../model-viewer-base.js';\nimport {FRAMED_HEIGHT} from '../three-components/ModelScene.js';\nimport {SmoothControls} from '../three-components/SmoothControls.js';\n\nconst HALF_PI = Math.PI / 2.0;\nconst THIRD_PI = Math.PI / 3.0;\nconst QUARTER_PI = HALF_PI / 2.0;\nconst PHI = 2.0 * Math.PI;\n\nconst AZIMUTHAL_QUADRANT_LABELS = ['front', 'right', 'back', 'left'];\nconst POLAR_TRIENT_LABELS = ['upper-', '', 'lower-'];\n\nconst ORBIT_NEAR_PLANE = 0.01;\nconst ORBIT_FAR_PLANE = 100;\n\nexport const IDLE_PROMPT_THRESHOLD_MS = 3000;\nexport const IDLE_PROMPT =\n    'Use mouse, touch or arrow keys to control the camera!';\n\nexport const $controls = Symbol('controls');\nconst $updateOrbitCamera = Symbol('updateOrbitCamera');\nconst $orbitCamera = Symbol('orbitCamera');\nconst $defaultCamera = Symbol('defaultCamera');\n\nconst $blurHandler = Symbol('blurHandler');\nconst $focusHandler = Symbol('focusHandler');\nconst $changeHandler = Symbol('changeHandler');\nconst $onBlur = Symbol('onBlur');\nconst $onFocus = Symbol('onFocus');\nconst $onChange = Symbol('onChange');\n\nconst $shouldPromptUserToInteract = Symbol('shouldPromptUserToInteract');\nconst $waitingToPromptUser = Symbol('waitingToPromptUser');\nconst $userPromptedOnce = Symbol('userPromptedOnce');\nconst $idleTime = Symbol('idleTime');\n\nconst $lastSpherical = Symbol('lastSpherical');\n\nexport const $promptElement = Symbol('promptElement');\n\nexport const ControlsMixin = (ModelViewerElement) => {\n  return class extends ModelViewerElement {\n    static get properties() {\n      return {...super.properties, controls: {type: Boolean}};\n    }\n\n    constructor() {\n      super();\n\n      this[$defaultCamera] = this[$scene].getCamera();\n\n      this[$idleTime] = 0;\n      this[$userPromptedOnce] = false;\n      this[$waitingToPromptUser] = false;\n      this[$shouldPromptUserToInteract] = true;\n\n      this[$promptElement] = this.shadowRoot.querySelector('.controls-prompt');\n\n      this[$orbitCamera] = this[$scene].camera.clone();\n      this[$orbitCamera].near = ORBIT_NEAR_PLANE;\n      this[$orbitCamera].far = ORBIT_FAR_PLANE;\n      this[$orbitCamera].updateProjectionMatrix();\n      this[$controls] = null;\n\n      this[$lastSpherical] = new Spherical();\n\n      this[$changeHandler] = () => this[$onChange]();\n      this[$focusHandler] = () => this[$onFocus]();\n      this[$blurHandler] = () => this[$onBlur]();\n    }\n\n    update(changedProperties) {\n      super.update(changedProperties);\n\n      if (!changedProperties.has('controls')) {\n        return;\n      }\n\n      if (this.controls) {\n        this[$scene].setCamera(this[$orbitCamera]);\n\n        this[$controls] =\n            new SmoothControls(this[$orbitCamera], this[$scene].canvas);\n        this[$controls].target.set(0, FRAMED_HEIGHT / 2, 0);\n\n        this[$controls].addEventListener('change', this[$changeHandler]);\n        this[$scene].canvas.addEventListener('focus', this[$focusHandler]);\n        this[$scene].canvas.addEventListener('blur', this[$blurHandler]);\n\n        this[$updateOrbitCamera]();\n      } else {\n        this[$scene].setCamera(this[$defaultCamera]);\n\n        if (this[$controls]) {\n          this[$controls].removeEventListener('change', this[$changeHandler]);\n          this[$scene].canvas.removeEventListener('focus', this[$focusHandler]);\n          this[$scene].canvas.removeEventListener('blur', this[$blurHandler]);\n\n          this[$controls].dispose();\n          this[$controls] = null;\n        }\n      }\n    }\n\n    [$tick](time, delta) {\n      super[$tick](time, delta);\n\n      if (this[$waitingToPromptUser]) {\n        this[$idleTime] += delta;\n\n        if (this[$idleTime] > IDLE_PROMPT_THRESHOLD_MS) {\n          this[$scene].canvas.setAttribute('aria-label', IDLE_PROMPT);\n\n          // NOTE(cdata): After notifying users that the controls are available,\n          // we flag that the user has been prompted at least once, and then\n          // effectively stop the idle timer. If the camera orbit changes after\n          // this point, the user will never be prompted again for this\n          // particular <model-element> instance:\n          this[$userPromptedOnce] = true;\n          this[$waitingToPromptUser] = false;\n\n          this[$promptElement].classList.add('visible');\n        }\n      }\n\n      if (this[$controls]) {\n        this[$controls].update(time, delta);\n      }\n    }\n\n    /**\n     * Copies over the default camera's values in order to frame\n     * the scene correctly.\n     */\n    [$updateOrbitCamera]() {\n      // The default camera already has positioned itself correctly\n      // to frame the canvas. Copy its values.\n      this[$orbitCamera].position.copy(this[$defaultCamera].position);\n      this[$orbitCamera].aspect = this[$defaultCamera].aspect;\n      this[$orbitCamera].rotation.set(0, 0, 0);\n      this[$orbitCamera].updateProjectionMatrix();\n\n      if (this[$controls]) {\n        // Zooming out beyond the 'frame' doesn't serve much purpose\n        // and will only end up showing the skysphere if zoomed out enough\n        this[$controls].applyOptions(\n            {maximumRadius: this[$orbitCamera].position.z});\n      }\n    }\n\n    [$onResize](e) {\n      super[$onResize](e);\n      this[$updateOrbitCamera]();\n    }\n\n    [$onModelLoad](e) {\n      super[$onModelLoad](e);\n      this[$updateOrbitCamera]();\n    }\n\n    [$onFocus]() {\n      const {canvas} = this[$scene];\n\n      // NOTE(cdata): On every re-focus, we switch the aria-label back to the\n      // original, non-prompt label if appropriate. If the user has already\n      // interacted, they no longer need to hear the prompt. Otherwise, they\n      // will hear it again after the idle prompt threshold has been crossed.\n      const ariaLabel = this[$ariaLabel];\n\n      if (canvas.getAttribute('aria-label') !== ariaLabel) {\n        canvas.setAttribute('aria-label', ariaLabel);\n      }\n\n      // NOTE(cdata): When focused, if the user has yet to interact with the\n      // camera controls (that is, we \"should\" prompt the user), we begin the\n      // idle timer and indicate that we are waiting for it to cross the\n      // prompt threshold:\n      if (this[$shouldPromptUserToInteract]) {\n        this[$waitingToPromptUser] = true;\n        this[$idleTime] = 0;\n      }\n    }\n\n    [$onBlur]() {\n      this[$waitingToPromptUser] = false;\n      this[$promptElement].classList.remove('visible');\n    }\n\n    [$onChange](e) {\n      this[$needsRender]();\n\n      // Effectively cancel the timer waiting for user interaction:\n      this[$waitingToPromptUser] = false;\n      this[$promptElement].classList.remove('visible');\n\n      // NOTE(cdata): On change (in other words, the camera has adjusted its\n      // orbit), if the user has been prompted at least once already, we no\n      // longer need to prompt the user in the future.\n      if (this[$userPromptedOnce]) {\n        this[$shouldPromptUserToInteract] = false;\n      }\n\n      const {theta: lastTheta, phi: lastPhi} = this[$lastSpherical];\n      const {theta, phi} =\n          this[$controls].getCameraSpherical(this[$lastSpherical]);\n\n      const lastAzimuthalQuadrant =\n          (4 + Math.floor(((lastTheta % PHI) + QUARTER_PI) / HALF_PI)) % 4;\n      const azimuthalQuadrant =\n          (4 + Math.floor(((theta % PHI) + QUARTER_PI) / HALF_PI)) % 4;\n\n      const lastPolarTrient = Math.floor(lastPhi / THIRD_PI);\n      const polarTrient = Math.floor(phi / THIRD_PI);\n\n      if (azimuthalQuadrant !== lastAzimuthalQuadrant ||\n          polarTrient !== lastPolarTrient) {\n        const {canvas} = this[$scene];\n        const azimuthalQuadrantLabel =\n            AZIMUTHAL_QUADRANT_LABELS[azimuthalQuadrant];\n        const polarTrientLabel = POLAR_TRIENT_LABELS[polarTrient];\n\n        const ariaLabel =\n            `View from stage ${polarTrientLabel}${azimuthalQuadrantLabel}`;\n\n        canvas.setAttribute('aria-label', ariaLabel);\n      }\n    }\n  };\n};\n"]}