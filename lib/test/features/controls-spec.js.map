{"version":3,"file":"controls-spec.js","sourceRoot":"","sources":["../../../src/test/features/controls-spec.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;GAaG;AAEH,OAAO,EAAC,SAAS,EAAE,cAAc,EAAE,aAAa,EAAE,WAAW,EAAE,wBAAwB,EAAC,MAAM,4BAA4B,CAAC;AAC3H,OAAO,sBAAsB,EAAE,EAAC,MAAM,EAAC,MAAM,4BAA4B,CAAC;AAC1E,OAAO,EAAC,SAAS,EAAE,sBAAsB,EAAE,SAAS,EAAE,UAAU,EAAE,KAAK,EAAE,YAAY,EAAC,MAAM,eAAe,CAAC;AAC5G,OAAO,EAAC,iBAAiB,EAAC,MAAM,iBAAiB,CAAC;AAClD,OAAO,EAAC,cAAc,EAAC,MAAM,4CAA4C,CAAC;AAE1E,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAE3B,MAAM,YAAY,GAAG,CAAC,OAAO,EAAE,EAAE;IAC/B,sBAAsB,CAAC,OAAO,EAAE,WAAW,EAAE,EAAC,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAC,CAAC,CAAC;IACxE,sBAAsB,CAAC,OAAO,EAAE,WAAW,EAAE,EAAC,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAC,CAAC,CAAC;AACzE,CAAC,CAAC;AAEF,KAAK,CAAC,2CAA2C,EAAE,GAAG,EAAE;IACtD,KAAK,CAAC,iBAAiB,EAAE,GAAG,EAAE;QAC5B,IAAI,MAAM,GAAG,CAAC,CAAC;QACf,IAAI,OAAO,CAAC;QACZ,IAAI,kBAAkB,CAAC;QAEvB,KAAK,CAAC,GAAG,EAAE;YACT,OAAO,GAAG,yBAAyB,MAAM,EAAE,EAAE,CAAC;YAC9C,kBAAkB,GAAG,KAAM,SAAQ,aAAa,CAC/C,sBAAsB,CAAC;gBACtB,MAAM,KAAK,EAAE;oBACX,OAAO,OAAO,CAAC;gBACjB,CAAC;aACF,CAAC;YACF,cAAc,CAAC,MAAM,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;QAEH,iBAAiB,CAAC,GAAG,EAAE,CAAC,kBAAkB,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC;QAE3D,KAAK,CAAC,UAAU,EAAE,GAAG,EAAE;YACrB,IAAI,OAAO,CAAC;YAEZ,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,OAAO,GAAG,IAAI,kBAAkB,EAAE,CAAC;gBACnC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBACnC,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC,WAAW,CAAC,CAAC;gBACrC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;gBAExB,MAAM,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YACtC,CAAC,CAAC,CAAC;YAEH,QAAQ,CAAC,GAAG,EAAE;gBACZ,IAAI,OAAO,CAAC,UAAU,IAAI,IAAI,EAAE;oBAC9B,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;iBACzC;YACH,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,mCAAmC,EAAE,GAAG,EAAE;gBAC7C,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACtC,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,+CAA+C,EAAE,GAAG,EAAE;gBACzD,MAAM,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAClD,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YACxE,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;gBAClE,OAAO,CAAC,QAAQ,GAAG,KAAK,CAAC;gBACzB,MAAM,UAAU,EAAE,CAAC;gBACnB,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE;gBACjB,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,MAAM,SAAS,EAAE,CAAC;gBACpB,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;oBACvD,MAAM,EAAC,MAAM,EAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;oBACjC,MAAM,aAAa,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;oBAC9C,MAAM,aAAa,GAAG,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;oBAExD,qEAAqE;oBACrE,oEAAoE;oBACpE,qEAAqE;oBACrE,iEAAiE;oBACjE,qCAAqC;oBACrC,MAAM,SAAS,EAAE,CAAC;oBAElB,MAAM,CAAC,KAAK,EAAE,CAAC;oBAEf,MAAM,KAAK,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,KAAK,WAAW,CAAC,CAAC;oBAErE,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBACxE,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;oBAC5D,MAAM,EAAC,MAAM,EAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;oBACjC,MAAM,aAAa,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;oBAC9C,MAAM,aAAa,GAAG,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;oBAExD,MAAM,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;oBAEnD,MAAM,CAAC,KAAK,EAAE,CAAC;oBAEf,MAAM,UAAU,EAAE,CAAC;oBAEnB,YAAY,CAAC,MAAM,CAAC,CAAC;oBAErB,MAAM,UAAU,CAAC,wBAAwB,GAAG,GAAG,CAAC,CAAC;oBAEjD,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;oBAClC,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;yBAC9C,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC1B,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,yDAAyD,EAAE,GAAG,EAAE;oBACnE,MAAM,EAAC,MAAM,EAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;oBACjC,MAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;oBAEpC,QAAQ,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC;oBAClC,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;oBAEzC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC;oBACjC,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;oBAE1C,QAAQ,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC3C,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;oBAEzC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBACpC,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;gBAC5C,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,uDAAuD,EAAE,GAAG,EAAE;oBACjE,MAAM,EAAC,MAAM,EAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;oBACjC,MAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;oBAEpC,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACxB,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,6BAA6B,CAAC,CAAC;oBAEhD,QAAQ,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC;oBAC3C,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;oBAE1C,QAAQ,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC;oBAC3C,cAAc,CAAC,QAAQ,CAAC,CAAC;oBAEzB,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;yBACpC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,6BAA6B,CAAC,CAAC;gBAClD,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {$controls, $promptElement, ControlsMixin, IDLE_PROMPT, IDLE_PROMPT_THRESHOLD_MS} from '../../features/controls.js';\nimport ModelViewerElementBase, {$scene} from '../../model-viewer-base.js';\nimport {assetPath, dispatchSyntheticEvent, rafPasses, timePasses, until, waitForEvent} from '../helpers.js';\nimport {BasicSpecTemplate} from '../templates.js';\nimport {settleControls} from '../three-components/SmoothControls-spec.js';\n\nconst expect = chai.expect;\n\nconst interactWith = (element) => {\n  dispatchSyntheticEvent(element, 'mousedown', {clientX: 0, clientY: 10});\n  dispatchSyntheticEvent(element, 'mousemove', {clientX: 0, clientY: 0});\n};\n\nsuite('ModelViewerElementBase with ControlsMixin', () => {\n  suite('when registered', () => {\n    let nextId = 0;\n    let tagName;\n    let ModelViewerElement;\n\n    setup(() => {\n      tagName = `model-viewer-controls-${nextId++}`;\n      ModelViewerElement = class extends ControlsMixin\n      (ModelViewerElementBase) {\n        static get is() {\n          return tagName;\n        }\n      };\n      customElements.define(tagName, ModelViewerElement);\n    });\n\n    BasicSpecTemplate(() => ModelViewerElement, () => tagName);\n\n    suite('controls', () => {\n      let element;\n\n      setup(async () => {\n        element = new ModelViewerElement();\n        document.body.appendChild(element);\n        element.src = assetPath('cube.gltf');\n        element.controls = true;\n\n        await waitForEvent(element, 'load');\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      test('creates SmoothControls if enabled', () => {\n        expect(element[$controls]).to.be.ok;\n      });\n\n      test('sets max radius to the camera framed distance', () => {\n        const cameraZ = element[$scene].camera.position.z;\n        expect(element[$controls].options.maximumRadius).to.be.equal(cameraZ);\n      });\n\n      test('removes SmoothControls if disabled after enabled', async () => {\n        element.controls = false;\n        await timePasses();\n        expect(element[$controls]).to.be.not.ok;\n      });\n\n      suite('a11y', () => {\n        setup(async () => {\n          await rafPasses();\n        });\n\n        test('prompts user to interact when focused', async () => {\n          const {canvas} = element[$scene];\n          const promptElement = element[$promptElement];\n          const originalLabel = canvas.getAttribute('aria-label');\n\n          // NOTE(cdata): This wait time was added in order to deflake tests on\n          // iOS Simulator and Android Emulator on Sauce Labs. These same test\n          // targets were tested manually locally and manually on Sauce, and do\n          // not fail. Only automated Sauce tests seem to fail consistently\n          // without this additional wait time:\n          await rafPasses();\n\n          canvas.focus();\n\n          await until(() => canvas.getAttribute('aria-label') === IDLE_PROMPT);\n\n          expect(promptElement.classList.contains('visible')).to.be.equal(true);\n        });\n\n        test('does not prompt if user already interacted', async () => {\n          const {canvas} = element[$scene];\n          const promptElement = element[$promptElement];\n          const originalLabel = canvas.getAttribute('aria-label');\n\n          expect(originalLabel).to.not.be.equal(IDLE_PROMPT);\n\n          canvas.focus();\n\n          await timePasses();\n\n          interactWith(canvas);\n\n          await timePasses(IDLE_PROMPT_THRESHOLD_MS + 100);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.not.be.equal(IDLE_PROMPT);\n          expect(promptElement.classList.contains('visible'))\n              .to.be.equal(false);\n        });\n\n        test('announces camera orientation when orbiting horizontally', () => {\n          const {canvas} = element[$scene];\n          const controls = element[$controls];\n\n          controls.setOrbit(-Math.PI / 2.0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage left');\n\n          controls.setOrbit(Math.PI / 2.0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage right');\n\n          controls.adjustOrbit(-Math.PI / 2.0, 0, 0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage back');\n\n          controls.adjustOrbit(Math.PI, 0, 0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage front');\n        });\n\n        test('announces camera orientation when orbiting vertically', () => {\n          const {canvas} = element[$scene];\n          const controls = element[$controls];\n\n          controls.setOrbit(0, 0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage upper-front');\n\n          controls.adjustOrbit(0, -Math.PI / 2.0, 0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage front');\n\n          controls.adjustOrbit(0, -Math.PI / 2.0, 0);\n          settleControls(controls);\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal('View from stage lower-front');\n        });\n      });\n    });\n  });\n});\n"]}