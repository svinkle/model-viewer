{"version":3,"file":"environment-spec.js","sourceRoot":"","sources":["../../../src/test/features/environment-spec.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;GAaG;AAEH,OAAO,EAAC,gBAAgB,EAAC,MAAM,+BAA+B,CAAC;AAC/D,OAAO,sBAAsB,EAAE,EAAC,MAAM,EAAC,MAAM,4BAA4B,CAAC;AAC1E,OAAO,EAAC,SAAS,EAAE,kBAAkB,EAAE,UAAU,EAAE,YAAY,EAAC,MAAM,eAAe,CAAC;AACtF,OAAO,EAAC,iBAAiB,EAAC,MAAM,iBAAiB,CAAC;AAElD,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAC3B,MAAM,gBAAgB,GAAG,SAAS,CAAC,cAAc,CAAC,CAAC;AACnD,MAAM,YAAY,GAAG,SAAS,CAAC,uBAAuB,CAAC,CAAC;AACxD,MAAM,SAAS,GAAG,SAAS,CAAC,wBAAwB,CAAC,CAAC;AACtD,MAAM,eAAe,GAAG,SAAS,CAAC,4DAA4D,CAAC,CAAC;AAChG,MAAM,wBAAwB,GAAG,SAAS,CAAC,eAAe,CAAC,CAAC;AAE5D,MAAM,gBAAgB,GAClB,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;IACb,OAAO,kBAAkB,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,EAAC,GAAG,EAAE,GAAG,EAAC,CAAC,CAAC;AAClE,CAAC,CAAA;AAEL,MAAM,kBAAkB,GACpB,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;IACb,IAAI,CAAC,KAAK,CAAC,UAAU,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE;QAClD,OAAO,KAAK,CAAC;KACd;IACD,OAAO,KAAK,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,GAAG,CAAC;AACjD,CAAC,CAAA;AAEL;;;;;;;;GAQG;AACH,MAAM,gBAAgB,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;IACvC,IAAI,KAAK,GAAG,KAAK,CAAC;IAClB,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC5B,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;YAClC,KAAK,GAAG,KAAK,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBACxC,OAAO,kBAAkB,CAAC,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC5C,CAAC,CAAC,CAAC;SACJ;aAAM,IAAI,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE;YACpD,KAAK,GAAG,KAAK,IAAI,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;SACnE;IACH,CAAC,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AAEF,MAAM,cAAc,GAAG,CAAC,KAAK,EAAE,EAAE;IAC/B,IAAI,KAAK,GAAG,KAAK,CAAC;IAClB,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC5B,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;YAClC,KAAK,GAAG,KAAK,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;SACtD;aACI,IAAI,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE;YAClD,KAAK,GAAG,IAAI,CAAC;SACd;IACH,CAAC,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC,CAAA;AAED;;;;;;;;;GASG;AACH,MAAM,aAAa,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,CAClC,YAAY,CAAC,KAAK,EAAE,eAAe,EAAE,KAAK,CAAC,EAAE;IAC3C,OAAO,kBAAkB,CAAC,KAAK,CAAC,KAAK,oBAAM,IAAI,EAAE,CAAC;AACpD,CAAC,CAAC,CAAC;AAEP;;;;GAIG;AACH,MAAM,oBAAoB,GACtB,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE;IACvB,MAAM,IAAI,GAAG,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAC3C,MAAM,MAAM,GAAG,aAAa,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAChD,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC;AACrC,CAAC,CAAA;AAEL,KAAK,CAAC,8CAA8C,EAAE,GAAG,EAAE;IACzD,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,IAAI,OAAO,CAAC;IACZ,IAAI,kBAAkB,CAAC;IACvB,IAAI,OAAO,CAAC;IACZ,IAAI,KAAK,CAAC;IAEV,KAAK,CAAC,GAAG,EAAE;QACT,OAAO,GAAG,4BAA4B,MAAM,EAAE,EAAE,CAAC;QACjD,kBAAkB,GAAG,KAAM,SAAQ,gBAAgB,CAClD,sBAAsB,CAAC;YACtB,MAAM,KAAK,EAAE;gBACX,OAAO,OAAO,CAAC;YACjB,CAAC;SACF,CAAC;QACF,cAAc,CAAC,MAAM,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;QACnD,OAAO,GAAG,IAAI,kBAAkB,EAAE,CAAC;QACnC,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;IAC1B,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;IAE9E,iBAAiB,CAAC,GAAG,EAAE,CAAC,kBAAkB,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC;IAE3D,IAAI,CACA,mEAAmE,EACnE,GAAG,EAAE;QACH,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;IAEP,IAAI,CACA,+EAA+E,EAC/E,KAAK,IAAI,EAAE;QACT,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACnC,MAAM,UAAU,EAAE,CAAC;QACnB,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;IAEP,KAAK,CAAC,kCAAkC,EAAE,GAAG,EAAE;QAC7C,KAAK,CAAC,oBAAoB,EAAE,GAAG,EAAE;YAC/B,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE,EAAC,GAAG,EAAE,YAAY,EAAC,CAAC,CAAC;gBACvE,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;gBACxB,OAAO,CAAC,eAAe,GAAG,YAAY,CAAC;gBACvC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM,MAAM,CAAC;YACf,CAAC,CAAC,CAAC;YAEH,QAAQ,CAAC,GAAG,EAAE;gBACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,0CAA0C,EAAE,KAAK;gBACpD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACpE,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,yCAAyC,EAAE,KAAK;gBACnD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE;oBAC7B,GAAG,EAAE,OAAO,CAAC,eAAe;iBAC7B,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,iCAAiC,EAAE,GAAG,EAAE;gBAC5C,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,OAAO,CAAC,eAAe,GAAG,SAAS,CAAC;oBACpC,MAAM,UAAU,EAAE,CAAC;gBACrB,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,gCAAgC,EAAE,GAAG,EAAE;oBAC1C,MAAM,UAAU,GACZ,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,WAAW,EAAE,CAAC;oBACzD,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;gBAC3C,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,mBAAmB,EAAE,GAAG,EAAE;gBAC9B,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE;wBAChD,GAAG,EAAE,YAAY;qBAClB,CAAC,CAAC;oBACH,OAAO,CAAC,GAAG,GAAG,eAAe,CAAC;oBAC9B,MAAM,MAAM,CAAC;gBACf,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,2CAA2C,EAAE,KAAK;oBACrD,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC;gBAC5C,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,uCAAuC,EAAE,GAAG,EAAE;gBAClD,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE;wBAChD,GAAG,EAAE,YAAY;qBAClB,CAAC,CAAC;oBACH,OAAO,CAAC,GAAG,GAAG,wBAAwB,CAAC;oBACvC,MAAM,MAAM,CAAC;gBACf,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,6DAA6D,EAAE,KAAK;oBACvE,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE;wBAC7B,GAAG,EAAE,OAAO,CAAC,eAAe;qBAC7B,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;gBACf,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,kCAAkC,EAAE,GAAG,EAAE;QAC7C,KAAK,CAAC,oBAAoB,EAAE,GAAG,EAAE;YAC/B,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE;oBAChD,GAAG,EAAE,IAAI;iBACV,CAAC,CAAC;gBACH,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;gBACxB,OAAO,CAAC,eAAe,GAAG,SAAS,CAAC;gBACpC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM,MAAM,CAAC;YACf,CAAC,CAAC,CAAC;YAEH,QAAQ,CAAC,GAAG,EAAE;gBACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,4CAA4C,EAAE,KAAK;gBACtD,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACvD,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,8CAA8C,EAAE,KAAK;gBACxD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE;oBAC7B,GAAG,EAAE,IAAI;iBACV,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC;YAEH,IAAI,CACA,+DAA+D,EAC/D,KAAK;gBACH,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM,UAAU,EAAE,CAAC;gBACnB,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACvD,CAAC,CAAC,CAAC;YACP,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE;gBAC3C,MAAM,UAAU,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,WAAW,EAAE,CAAC;gBACxE,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,mBAAmB,EAAE,GAAG,EAAE;gBAC9B,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE;wBAChD,GAAG,EAAE,IAAI;qBACV,CAAC,CAAC;oBACH,OAAO,CAAC,GAAG,GAAG,eAAe,CAAC;oBAC9B,MAAM,MAAM,CAAC;gBACf,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,2CAA2C,EAAE,KAAK;oBACrD,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC;gBAC5C,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,UAAU,EAAE,GAAG,EAAE;QACrB,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;YACxB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACnC,MAAM,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;YACnE,MAAM,2BAA2B,GAC7B,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,mBAAmB,CAAC;YAChD,OAAO,CAAC,QAAQ,GAAG,GAAG,CAAC;YACvB,MAAM,UAAU,EAAE,CAAC;YACnB,MAAM,sBAAsB,GACxB,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,mBAAmB,CAAC;YAChD,MAAM,CAAC,sBAAsB,CAAC;iBACzB,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,2BAA2B,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,uBAAuB,EAAE,GAAG,EAAE;QAClC,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;YACxB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACnC,MAAM,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACrD,MAAM,sBAAsB,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;YACrD,OAAO,CAAC,mBAAmB,GAAG,GAAG,CAAC;YAClC,MAAM,UAAU,EAAE,CAAC;YACnB,MAAM,iBAAiB,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;YAChD,MAAM,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAC;QACnE,CAAC,CAAC,CAAC;QAEH,KAAK,CAAC,yBAAyB,EAAE,GAAG,EAAE;YACpC,IAAI,CAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;gBACtD,OAAO,CAAC,mBAAmB,GAAG,GAAG,CAAC;gBAClC,MAAM,UAAU,EAAE,CAAC;gBACnB,MAAM,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;gBAC7C,OAAO,CAAC,iBAAiB,GAAG,IAAI,CAAC;gBACjC,MAAM,YAAY,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;gBAClD,MAAM,iBAAiB,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;gBAChD,MAAM,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC3D,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC7B,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;YACxB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACnC,MAAM,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YAC1D,MAAM,eAAe,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;YACtD,OAAO,CAAC,eAAe,GAAG,GAAG,CAAC;YAC9B,MAAM,UAAU,EAAE,CAAC;YACnB,MAAM,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;YACjD,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,mBAAmB,EAAE,GAAG,EAAE;QAC9B,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE,EAAC,GAAG,EAAE,YAAY,EAAC,CAAC,CAAC;YACvE,OAAO,CAAC,YAAY,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YACvC,OAAO,CAAC,YAAY,CAAC,kBAAkB,EAAE,SAAS,CAAC,CAAC;YACpD,OAAO,CAAC,YAAY,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;YACxD,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACnC,MAAM,MAAM,CAAC;QACf,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oDAAoD,EAAE,GAAG,EAAE;YAC9D,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,OAAO,CAAC,gBAAgB,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAC5E,CAAC,CAAC,CAAC;QAEH,KAAK,CAAC,4CAA4C,EAAE,GAAG,EAAE;YACvD,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,IAAI,aAAa,GAAG,aAAa,CAAC,KAAK,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC;gBAC5D,OAAO,CAAC,eAAe,CAAC,mBAAmB,CAAC,CAAC;gBAC7C,MAAM,aAAa,CAAC;YACtB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,8CAA8C,EAAE,GAAG,EAAE;gBACxD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACxD,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,uDAAuD,EAAE,GAAG,EAAE;QAClE,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,EAAE,OAAO,EAAE,EAAC,GAAG,EAAE,YAAY,EAAC,CAAC,CAAC;YACvE,OAAO,CAAC,YAAY,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YACvC,OAAO,CAAC,YAAY,CAAC,kBAAkB,EAAE,SAAS,CAAC,CAAC;YACpD,OAAO,CAAC,YAAY,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC;YACvD,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACnC,MAAM,MAAM,CAAC;QACf,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,2CAA2C,EAAE,KAAK;YACrD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mDAAmD,EAAE,KAAK;YAC7D,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,OAAO,CAAC,eAAe,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAC3E,CAAC,CAAC,CAAC;QAEH,KAAK,CAAC,2BAA2B,EAAE,GAAG,EAAE;YACtC,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,MAAM,kBAAkB,GAAG,YAAY,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;gBACvE,OAAO,CAAC,YAAY,CAAC,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;gBAC5D,MAAM,kBAAkB,CAAC;YAC3B,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,8CAA8C,EAAE,GAAG,EAAE;gBACxD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,gBAAgB,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACpE,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,4CAA4C,EAAE,GAAG,EAAE;gBACvD,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,MAAM,kBAAkB,GACpB,YAAY,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;oBAChD,OAAO,CAAC,eAAe,CAAC,mBAAmB,CAAC,CAAC;oBAC7C,MAAM,kBAAkB,CAAC;gBAC3B,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,0CAA0C,EAAE,GAAG,EAAE;oBACpD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,YAAY,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;gBAChE,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,2CAA2C,EAAE,GAAG,EAAE;gBACtD,KAAK,CAAC,KAAK,IAAI,EAAE;oBACf,MAAM,kBAAkB,GACpB,YAAY,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;oBAChD,OAAO,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;oBAC5C,MAAM,kBAAkB,CAAC;gBAC3B,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,sDAAsD,EAAE,GAAG,EAAE;oBAChE,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,gBAAgB,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;gBACpE,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,2CAA2C,EAAE,KAAK;oBACrD,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;gBACvD,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,KAAK,CAAC,2CAA2C,EAAE,GAAG,EAAE;YACtD,KAAK,CAAC,KAAK,IAAI,EAAE;gBACf,IAAI,aAAa,GAAG,aAAa,CAAC,KAAK,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC;gBAC5D,OAAO,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;gBAC5C,MAAM,aAAa,CAAC;YACtB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,2CAA2C,EAAE,KAAK;gBACrD,MAAM,CAAC,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACvD,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,8CAA8C,EAAE,KAAK;gBACxD,MAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACxD,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {EnvironmentMixin} from '../../features/environment.js';\nimport ModelViewerElementBase, {$scene} from '../../model-viewer-base.js';\nimport {assetPath, textureMatchesMeta, timePasses, waitForEvent} from '../helpers.js';\nimport {BasicSpecTemplate} from '../templates.js';\n\nconst expect = chai.expect;\nconst ALT_BG_IMAGE_URL = assetPath('quick_4k.png');\nconst BG_IMAGE_URL = assetPath('spruit_sunrise_2k.jpg');\nconst MODEL_URL = assetPath('reflective-sphere.gltf');\nconst UNLIT_MODEL_URL = assetPath('glTF-Sample-Models/2.0/UnlitTest/glTF-Binary/UnlitTest.glb');\nconst MULTI_MATERIAL_MODEL_URL = assetPath('Triangle.gltf');\n\nconst backgroundHasMap =\n    (scene, url) => {\n      return textureMatchesMeta(scene.background.texture, {url: url});\n    }\n\nconst backgroundHasColor =\n    (scene, hex) => {\n      if (!scene.background || !scene.background.isColor) {\n        return false;\n      }\n      return scene.background.getHexString() === hex;\n    }\n\n/**\n * Takes a scene and a meta object and returns a\n * boolean indicating whether or not the scene's model has an\n * environment map applied that matches the meta object.\n *\n * @see textureMatchesMeta\n * @param {THREE.Scene} scene\n * @param {Object} meta\n */\nconst modelUsingEnvMap = (scene, meta) => {\n  let found = false;\n  scene.model.traverse(object => {\n    if (Array.isArray(object.material)) {\n      found = found || object.material.some(m => {\n        return textureMatchesMeta(m.envMap, meta);\n      });\n    } else if (object.material && object.material.envMap) {\n      found = found || textureMatchesMeta(object.material.envMap, meta);\n    }\n  });\n  return found;\n};\n\nconst modelHasEnvMap = (scene) => {\n  let found = false;\n  scene.model.traverse(object => {\n    if (Array.isArray(object.material)) {\n      found = found || object.material.some(m => m.envMap);\n    }\n    else if (object.material && object.material.envMap) {\n      found = true;\n    }\n  });\n  return found;\n}\n\n/**\n * Takes a model object and a meta object and returns\n * a promise that resolves when the model's environment map has\n * been set to a texture that has `userData` that matches\n * the passed in `meta`.\n *\n * @see textureMatchesMeta\n * @param {Model} model\n * @param {Object} meta\n */\nconst waitForEnvMap = (model, meta) =>\n    waitForEvent(model, 'envmap-change', event => {\n      return textureMatchesMeta(event.value, {...meta});\n    });\n\n/**\n * Returns a promise that resolves when a given element is loaded\n * and has an environment map set that matches the passed in meta.\n * @see textureMatchesMeta\n */\nconst waitForLoadAndEnvMap =\n    (scene, element, meta) => {\n      const load = waitForEvent(element, 'load');\n      const envMap = waitForEnvMap(scene.model, meta);\n      return Promise.all([load, envMap]);\n    }\n\nsuite('ModelViewerElementBase with EnvironmentMixin', () => {\n  let nextId = 0;\n  let tagName;\n  let ModelViewerElement;\n  let element;\n  let scene;\n\n  setup(() => {\n    tagName = `model-viewer-environment-${nextId++}`;\n    ModelViewerElement = class extends EnvironmentMixin\n    (ModelViewerElementBase) {\n      static get is() {\n        return tagName;\n      }\n    };\n    customElements.define(tagName, ModelViewerElement);\n    element = new ModelViewerElement();\n    scene = element[$scene];\n  });\n\n  teardown(() => element.parentNode && element.parentNode.removeChild(element));\n\n  BasicSpecTemplate(() => ModelViewerElement, () => tagName);\n\n  test(\n      'has default background if no background-image or background-color',\n      () => {\n        expect(backgroundHasColor(scene, 'ffffff')).to.be.equal(true);\n      });\n\n  test(\n      'has default background if no background-image or background-color when in DOM',\n      async () => {\n        document.body.appendChild(element);\n        await timePasses();\n        expect(backgroundHasColor(scene, 'ffffff')).to.be.equal(true);\n      });\n\n  suite('with a background-image property', () => {\n    suite('and a src property', () => {\n      setup(async () => {\n        let onLoad = waitForLoadAndEnvMap(scene, element, {url: BG_IMAGE_URL});\n        element.src = MODEL_URL;\n        element.backgroundImage = BG_IMAGE_URL;\n        document.body.appendChild(element);\n        await onLoad;\n      });\n\n      teardown(() => {\n        document.body.removeChild(element);\n      });\n\n      test('displays background with the correct map', async function() {\n        expect(backgroundHasMap(scene, element.backgroundImage)).to.be.ok;\n      });\n\n      test('applies the image as an environment map', async function() {\n        expect(modelUsingEnvMap(scene, {\n          url: element.backgroundImage\n        })).to.be.ok;\n      });\n\n      suite('and a background-color property', () => {\n        setup(async () => {\n          element.backgroundColor = '#ff0077';\n          await timePasses();\n        });\n\n        test('the directional light is white', () => {\n          const lightColor =\n              scene.shadowLight.color.getHexString().toLowerCase();\n          expect(lightColor).to.be.equal('ffffff');\n        });\n      });\n\n      suite('on an unlit model', () => {\n        setup(async () => {\n          let onLoad = waitForLoadAndEnvMap(scene, element, {\n            url: BG_IMAGE_URL,\n          });\n          element.src = UNLIT_MODEL_URL;\n          await onLoad;\n        });\n        test('applies no environment map on unlit model', async function() {\n          expect(modelHasEnvMap(scene)).to.be.false;\n        });\n      });\n\n      suite('on a model with multi-material meshes', () => {\n        setup(async () => {\n          let onLoad = waitForLoadAndEnvMap(scene, element, {\n            url: BG_IMAGE_URL,\n          });\n          element.src = MULTI_MATERIAL_MODEL_URL;\n          await onLoad;\n        });\n        test('applies environment map on model with multi-material meshes', async function() {\n          expect(modelUsingEnvMap(scene, {\n            url: element.backgroundImage\n          })).to.be.ok;\n        });\n      });\n    });\n  });\n\n  suite('with a background-color property', () => {\n    suite('and a src property', () => {\n      setup(async () => {\n        let onLoad = waitForLoadAndEnvMap(scene, element, {\n          url: null,\n        });\n        element.src = MODEL_URL;\n        element.backgroundColor = '#ff0077';\n        document.body.appendChild(element);\n        await onLoad;\n      });\n\n      teardown(() => {\n        document.body.removeChild(element);\n      });\n\n      test('displays background with the correct color', async function() {\n        expect(backgroundHasColor(scene, 'ff0077')).to.be.ok;\n      });\n\n      test('applies a generated environment map on model', async function() {\n        expect(modelUsingEnvMap(scene, {\n          url: null,\n        })).to.be.ok;\n      });\n\n      test(\n          'displays background with correct color after attaching to DOM',\n          async function() {\n            document.body.appendChild(element);\n            await timePasses();\n            expect(backgroundHasColor(scene, 'ff0077')).to.be.ok;\n          });\n      test('the directional light is tinted', () => {\n        const lightColor = scene.shadowLight.color.getHexString().toLowerCase();\n        expect(lightColor).to.not.be.equal('ffffff');\n      });\n\n      suite('on an unlit model', () => {\n        setup(async () => {\n          let onLoad = waitForLoadAndEnvMap(scene, element, {\n            url: null,\n          });\n          element.src = UNLIT_MODEL_URL;\n          await onLoad;\n        });\n        test('applies no environment map on unlit model', async function() {\n          expect(modelHasEnvMap(scene)).to.be.false;\n        });\n      });\n    });\n  });\n\n  suite('exposure', () => {\n    setup(async () => {\n      element.src = MODEL_URL;\n      document.body.appendChild(element);\n      await waitForEvent(element, 'load');\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('changes the tone mapping exposure of the renderer', async () => {\n      const originalToneMappingExposure =\n          scene.renderer.renderer.toneMappingExposure;\n      element.exposure = 2.0;\n      await timePasses();\n      const newToneMappingExposure =\n          scene.renderer.renderer.toneMappingExposure;\n      expect(newToneMappingExposure)\n          .to.be.greaterThan(originalToneMappingExposure);\n    });\n  });\n\n  suite('stage-light-intensity', () => {\n    setup(async () => {\n      element.src = MODEL_URL;\n      document.body.appendChild(element);\n      await waitForEvent(element, 'load');\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('changes model scene light intensity', async () => {\n      const originalLightIntensity = scene.light.intensity;\n      element.stageLightIntensity = 0.5;\n      await timePasses();\n      const newLightIntensity = scene.light.intensity;\n      expect(newLightIntensity).to.be.lessThan(originalLightIntensity);\n    });\n\n    suite('with experimental-pmrem', () => {\n      test('further lowers scene light intensity', async () => {\n        element.stageLightIntensity = 0.5;\n        await timePasses();\n        const lightIntensity = scene.light.intensity;\n        element.experimentalPmrem = true;\n        await waitForEvent(element, 'environment-change');\n        const newLightIntensity = scene.light.intensity;\n        expect(newLightIntensity).to.be.lessThan(lightIntensity);\n      });\n    });\n  });\n\n  suite('shadow-intensity', () => {\n    setup(async () => {\n      element.src = MODEL_URL;\n      document.body.appendChild(element);\n      await waitForEvent(element, 'load');\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('changes the opacity of the static shadow', async () => {\n      const originalOpacity = scene.shadow.material.opacity;\n      element.shadowIntensity = 1.0;\n      await timePasses();\n      const newOpacity = scene.shadow.material.opacity;\n      expect(newOpacity).to.be.greaterThan(originalOpacity);\n    });\n  });\n\n  suite('environment-image', () => {\n    setup(async () => {\n      let onLoad = waitForLoadAndEnvMap(scene, element, {url: BG_IMAGE_URL});\n      element.setAttribute('src', MODEL_URL);\n      element.setAttribute('background-color', '#ff0077');\n      element.setAttribute('environment-image', BG_IMAGE_URL);\n      document.body.appendChild(element);\n      await onLoad;\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('applies environment-image environment map on model', () => {\n      expect(modelUsingEnvMap(scene, {url: element.environmentImage})).to.be.ok;\n    });\n\n    suite('and environment-image subsequently removed', () => {\n      setup(async () => {\n        let envMapChanged = waitForEnvMap(scene.model, {url: null});\n        element.removeAttribute('environment-image');\n        await envMapChanged;\n      });\n\n      test('reapplies generated environment map on model', () => {\n        expect(modelUsingEnvMap(scene, {url: null})).to.be.ok;\n      });\n    });\n  });\n\n  suite('with background-color and background-image properties', () => {\n    setup(async () => {\n      let onLoad = waitForLoadAndEnvMap(scene, element, {url: BG_IMAGE_URL});\n      element.setAttribute('src', MODEL_URL);\n      element.setAttribute('background-color', '#ff0077');\n      element.setAttribute('background-image', BG_IMAGE_URL);\n      document.body.appendChild(element);\n      await onLoad;\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('displays background with background-image', async function() {\n      expect(backgroundHasMap(scene, element.backgroundImage)).to.be.ok;\n    });\n\n    test('applies background-image environment map on model', async function() {\n      expect(modelUsingEnvMap(scene, {url: element.backgroundImage})).to.be.ok;\n    });\n\n    suite('with an environment-image', () => {\n      setup(async () => {\n        const environmentChanged = waitForEvent(element, 'environment-change');\n        element.setAttribute('environment-image', ALT_BG_IMAGE_URL);\n        await environmentChanged;\n      });\n\n      test('prefers environment-image as environment map', () => {\n        expect(modelUsingEnvMap(scene, {url: ALT_BG_IMAGE_URL})).to.be.ok;\n      });\n\n      suite('and environment-image subsequently removed', () => {\n        setup(async () => {\n          const environmentChanged =\n              waitForEvent(element, 'environment-change');\n          element.removeAttribute('environment-image');\n          await environmentChanged;\n        });\n\n        test('uses background-image as environment map', () => {\n          expect(modelUsingEnvMap(scene, {url: BG_IMAGE_URL})).to.be.ok;\n        });\n      });\n\n      suite('and background-image subsequently removed', () => {\n        setup(async () => {\n          const environmentChanged =\n              waitForEvent(element, 'environment-change');\n          element.removeAttribute('background-image');\n          await environmentChanged;\n        });\n\n        test('continues using environment-image as environment map', () => {\n          expect(modelUsingEnvMap(scene, {url: ALT_BG_IMAGE_URL})).to.be.ok;\n        });\n\n        test('displays background with background-color', async function() {\n          expect(backgroundHasColor(scene, 'ff0077')).to.be.ok;\n        });\n      });\n    });\n\n    suite('and background-image subsequently removed', () => {\n      setup(async () => {\n        let envMapChanged = waitForEnvMap(scene.model, {url: null});\n        element.removeAttribute('background-image');\n        await envMapChanged;\n      });\n\n      test('displays background with background-color', async function() {\n        expect(backgroundHasColor(scene, 'ff0077')).to.be.ok;\n      });\n\n      test('reapplies generated environment map on model', async function() {\n        expect(modelUsingEnvMap(scene, {url: null})).to.be.ok;\n      });\n    });\n  });\n});\n"]}